// ê¶ê¶ ê±´ë¬¼ í´ë¦¬ê³¤ ì˜ì—­ ë°ì´í„°
export const buildingPolygons = [
  {
    id: 'eungjidang',
    name: 'ì‘ì§€ë‹¹',
    nameEn: 'Eungjidang',
    nw: [37.579595432157966, 126.97667876079947],
    se: [37.57955041200325, 126.9768287778653]
  },
  {
    id: 'gyeongseongjeon',
    name: 'ê²½ì„±ì „',
    nameEn: 'Gyeongseongjeon',
    nw: [37.579534628470896, 126.97674670564773],
    se: [37.5793566949806, 126.97681185646736]
  },
  {
    id: 'gangnyeongjeon',
    name: 'ê°•ë…•ì „',
    nameEn: 'Gangnyeongjeon',
    nw: [37.57947608222901, 126.97684012187166],
    se: [37.57938156638848, 126.97729581968161]
  },
  {
    id: 'yeongildang',
    name: 'ì—°ê¸¸ë‹¹',
    nameEn: 'Yeongildang',
    nw: [37.579570782721284, 126.97733538567671],
    se: [37.579516750173134, 126.97747691427828]
  },
  {
    id: 'yeonsaengjeon',
    name: 'ì—°ìƒì „',
    nameEn: 'Yeonsaengjeon',
    nw: [37.579505456315, 126.97731276352641],
    se: [37.57932977662259, 126.97738640300386]
  },
  {
    id: 'hamwonjeon',
    name: 'í•¨ì›ì „',
    nameEn: 'Hamwonjeon',
    nw: [37.57997156848415, 126.97653430013388],
    se: [37.5799107922909, 126.97674092814219]
  },
  {
    id: 'heumgyeonggak',
    name: 'í ê²½ê°',
    nameEn: 'Heumgyeonggak',
    nw: [37.57972153988065, 126.97652022734192],
    se: [37.5796810316051, 126.97670420635653]
  },
  {
    id: 'hamhonggak',
    name: 'í•¨í™ê°',
    nameEn: 'Hamhonggak',
    nw: [37.579897294638215, 126.97682867036573],
    se: [37.57987252951355, 126.9768909437149]
  },
  {
    id: 'gyotaejeon',
    name: 'êµíƒœì „',
    nameEn: 'Gyotaejeon',
    nw: [37.57989055382053, 126.97691358021297],
    se: [37.57982529770065, 126.97725323109862]
  },
  {
    id: 'cheonchujeon',
    name: 'ì²œì¶”ì „',
    nameEn: 'Cheonchujeon',
    nw: [37.579081849944046, 126.97659967460333],
    se: [37.57900755370943, 126.97678083226626]
  },
  {
    id: 'sajeongjeon',
    name: 'ì‚¬ì •ì „',
    nameEn: 'Sajeongjeon',
    nw: [37.579045873149205, 126.97691950147181],
    se: [37.57898059787739, 126.97716009067494]
  },
  {
    id: 'manchunjeon',
    name: 'ë§Œì¶˜ì „',
    nameEn: 'Manchunjeon',
    nw: [37.579057211291925, 126.97731006930693],
    se: [37.57899192120716, 126.97747707237069]
  },
  {
    id: 'geungjeongjeon',
    name: 'ê¸ì •ì „',
    nameEn: 'Geungjeongjeon',
    nw: [37.57881379918469, 126.97657428653042],
    se: [37.57796927076278, 126.9773613427869]
  },
  {
    id: 'saengmulbang',
    name: 'ìƒë¬¼ë°©',
    nameEn: 'Saengmulbang',
    nw: [37.57981868396979, 126.97801174168946],
    se: [37.57957326773343, 126.9785806934287]
  },
  {
    id: 'naesojubang',
    name: 'ë‚´ì†Œì£¼ë°©',
    nameEn: 'Naesojubang',
    nw: [37.57958887427102, 126.97771180306918],
    se: [37.57934565795998, 126.97798923889174]
  },
  {
    id: 'oesojubang',
    name: 'ì™¸ì†Œì£¼ë°©',
    nameEn: 'Oesojubang',
    nw: [37.57956642252148, 126.97810238375722],
    se: [37.57934799194355, 126.97843075534465]
  },
  {
    id: 'jaseondang',
    name: 'ìì„ ë‹¹',
    nameEn: 'Jaseondang',
    nw: [37.57912038087951, 126.97783647281683],
    se: [37.57893122337011, 126.97811106044927]
  },
  {
    id: 'bihyeongak',
    name: 'ë¹„í˜„ê°',
    nameEn: 'Bihyeongak',
    nw: [37.57910244983463, 126.97831478679606],
    se: [37.57891553753182, 126.97855540984938]
  },
  {
    id: 'jagyeongjeon',
    name: 'ìê²½ì „',
    nameEn: 'Jagyeongjeon',
    nw: [37.58025564111767, 126.97787859038306],
    se: [37.580149824427416, 126.97814749719116]
  },
  {
    id: 'heungbokjeon',
    name: 'í¥ë³µì „',
    nameEn: 'Heungbokjeon',
    nw: [37.580928868144134, 126.97650286640851],
    se: [37.580557351334214, 126.9772331963983]
  },
  {
    id: 'gyejodang',
    name: 'ê³„ì¡°ë‹¹',
    nameEn: 'Gyejodang',
    nw: [37.57794005256122, 126.97769814362223],
    se: [37.57773738094997, 126.97797556142645]
  }
];

// ì ì´ ì‚¬ê°í˜• í´ë¦¬ê³¤ ì•ˆì— ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
export const isPointInPolygon = (lat, lng, polygon) => {
  // GPS ì˜¤ì°¨ë¥¼ ê³ ë ¤í•œ ì—¬ìœ  ë²”ìœ„ (ì•½ 5ë¯¸í„°)
  const buffer = 0.00005; // ì•½ 5ë¯¸í„° ì •ë„ì˜ ì—¬ìœ 

  // ë¶ì„œ(NW)ì™€ ë‚¨ë™(SE) ì¢Œí‘œë¥¼ ì´ìš©í•œ ì‚¬ê°í˜• ì˜ì—­ ì²´í¬ (ë²„í¼ ì ìš©)
  const northLat = polygon.nw[0] + buffer;  // ë¶ìª½ ìœ„ë„ (í™•ì¥)
  const westLng = polygon.nw[1] - buffer;   // ì„œìª½ ê²½ë„ (í™•ì¥)
  const southLat = polygon.se[0] - buffer;  // ë‚¨ìª½ ìœ„ë„ (í™•ì¥)
  const eastLng = polygon.se[1] + buffer;   // ë™ìª½ ê²½ë„ (í™•ì¥)

  console.log(`ğŸ” í´ë¦¬ê³¤ ì²´í¬: ${polygon.name} (ë²„í¼: ${buffer})`);
  console.log(`   GPS: ${lat.toFixed(6)}, ${lng.toFixed(6)}`);
  console.log(`   ì›ë³¸ - ë¶: ${polygon.nw[0].toFixed(6)}, ë‚¨: ${polygon.se[0].toFixed(6)}`);
  console.log(`   ì›ë³¸ - ì„œ: ${polygon.nw[1].toFixed(6)}, ë™: ${polygon.se[1].toFixed(6)}`);
  console.log(`   í™•ì¥ - ë¶: ${northLat.toFixed(6)}, ë‚¨: ${southLat.toFixed(6)}`);
  console.log(`   í™•ì¥ - ì„œ: ${westLng.toFixed(6)}, ë™: ${eastLng.toFixed(6)}`);

  const latInRange = lat <= northLat && lat >= southLat;
  const lngInRange = lng >= westLng && lng <= eastLng;

  console.log(`   ìœ„ë„ ë²”ìœ„: ${latInRange} (${lat} <= ${northLat} && ${lat} >= ${southLat})`);
  console.log(`   ê²½ë„ ë²”ìœ„: ${lngInRange} (${lng} >= ${westLng} && ${lng} <= ${eastLng})`);

  // ì ì´ ì‚¬ê°í˜• ì˜ì—­ ì•ˆì— ìˆëŠ”ì§€ í™•ì¸
  const isInside = latInRange && lngInRange;
  console.log(`   ê²°ê³¼: ${isInside ? 'âœ… ë‚´ë¶€' : 'âŒ ì™¸ë¶€'}`);

  return isInside;
};

// GPS ìœ„ì¹˜ë¡œ í•´ë‹¹í•˜ëŠ” ê±´ë¬¼ í´ë¦¬ê³¤ ì°¾ê¸°
export const findBuildingByPolygon = (lat, lng) => {
  console.log(`í´ë¦¬ê³¤ ê²€ìƒ‰: ìœ„ì¹˜ ${lat.toFixed(6)}, ${lng.toFixed(6)}`);

  for (const polygon of buildingPolygons) {
    if (isPointInPolygon(lat, lng, polygon)) {
      console.log(`ğŸ¯ í´ë¦¬ê³¤ ë§¤ì¹­ ì„±ê³µ: ${polygon.name}`);
      return {
        id: polygon.id,
        name: polygon.name,
        nameEn: polygon.nameEn,
        coordinates: {
          // í´ë¦¬ê³¤ ì¤‘ì‹¬ì  ê³„ì‚°
          lat: (polygon.nw[0] + polygon.se[0]) / 2,
          lng: (polygon.nw[1] + polygon.se[1]) / 2
        },
        distance: 0, // í´ë¦¬ê³¤ ì•ˆì— ìˆìœ¼ë¯€ë¡œ ê±°ë¦¬ëŠ” 0
        isInPolygon: true,
        polygonData: polygon
      };
    }
  }

  console.log('âŒ í•´ë‹¹í•˜ëŠ” í´ë¦¬ê³¤ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
  return null;
};

// í´ë¦¬ê³¤ IDë¥¼ ê¸°ì¡´ ê±´ë¬¼ ë°ì´í„° IDë¡œ ë§¤í•‘
export const mapPolygonToBuilding = (polygonId) => {
  const mapping = {
    'eungjidang': 'eungjidang',
    'gyeongseongjeon': 'gyeongseungjeon', // ê²½ì„±ì „
    'gangnyeongjeon': 'gangnyeongjeon',
    'yeongildang': 'yeongildang',
    'yeonsaengjeon': 'yeonsaengjeon',
    'hamwonjeon': 'hamwonjeon',
    'heumgyeonggak': 'heumgyeonggak',
    'hamhonggak': 'hamhonggak',
    'gyotaejeon': 'gyotaejeon',
    'cheonchujeon': 'cheonchujeon',
    'sajeongjeon': 'sajeongjeon',
    'manchunjeon': 'manchunjeon',
    'geungjeongjeon': 'geunjeongjeon', // ê¸ì •ì „ -> ê·¼ì •ì „
    'saengmulbang': 'saengmulbang',
    'naesojubang': 'naesojubang',
    'oesojubang': 'oesojubang',
    'jaseondang': 'jaseondang',
    'bihyeongak': 'bihyeongak',
    'jagyeongjeon': 'jagyeongjeon',
    'heungbokjeon': 'heungbokjeon',
    'gyejodang': 'gyejodang'
  };

  return mapping[polygonId] || polygonId;
};